##### 📋 서브 모듈 명세서의 특징
##### 🎯 상위 시스템과의 연계

##### Nova-8000 AP의 서브 모듈로서 역할 명확화
##### 전체 시스템 내에서의 인터페이스 정의
##### 상위 프로젝트 일정과 동기화된 개발 계획

##### 🔧 모듈 레벨 상세 설계
   - 구체적 아키텍처: 8×4 DSP 어레이, ARM Cortex-M7 제어
   - 상세 인터페이스: MIPI CSI-2, AXI4-Stream 등 실제 프로토콜
   - 물리적 설계: 4.6×2.9mm 플로어플랜과 배치 전략

##### 📊 실무 중심 내용
   - 검증 계획: UVM 기반 체계적 검증 환경
   - 구현 일정: 21주 상세 개발 일정
   - 품질 관리: ECC, BIST 등 신뢰성 설계

##### 💡 활용 방법
   - 다른 모듈 적용: GPU, 모뎀, 오디오 등 다른 서브 모듈에 구조 적용
   - 팀별 개발: 3-7명 소규모 팀 단위 모듈 개발에 최적화
   - 단계별 검토: 주요 마일스톤별 진행 상황 추적 가능

# ISP 모듈 설계 명세서
## Image Signal Processor (ISP) Module Design Specification

---

### 문서 정보 (Document Information)
- **상위 프로젝트**: Nova-8000 Series AP Development
- **모듈명**: Nova-ISP v3.0 (18-bit Image Signal Processor)
- **문서 버전**: v1.0
- **작성일**: 2025-09-14
- **작성자**: 정수연 (ISP Design Team)
- **검토자**: 김철수 (SoC Design Team Lead)
- **승인자**: 박영희 (Design Manager)

---

## 1. 모듈 개요 (Module Overview)

### 1.1 모듈 목적 및 역할
- **개발 목적**: Nova-8000 AP 내장형 고성능 이미지 신호 프로세서 개발
- **시스템 내 역할**: 카메라 센서 RAW 데이터를 YUV/RGB 포맷으로 변환 및 화질 향상
- **상위 시스템 연동**: Nova-8000 AP의 멀티미디어 서브시스템 구성요소
- **타겟 성능**: 200MP@30fps 단일 센서, 64MP@60fps 듀얼 센서 동시 처리

### 1.2 모듈 위치 및 인터페이스
- **시스템 블록도 내 위치**: 메인 SoC와 카메라 센서 사이
- **상위 연결**: AXI4 버스를 통한 CPU/GPU 연동
- **하위 연결**: MIPI CSI-2 4-lane × 4채널 입력
- **주변 모듈**: 비디오 코덱, 디스플레이 컨트롤러와 협업

---

## 2. 기능 명세 (Functional Specifications)

### 2.1 핵심 기능 (Core Functions)
- **RAW 데이터 처리**: Bayer Pattern → RGB 변환 (18-bit 파이프라인)
- **화질 향상**: 노이즈 리덕션, 화이트 밸런스, 색상 보정
- **자동 제어**: Auto Focus, Auto Exposure, Auto White Balance
- **실시간 처리**: 하드웨어 기반 실시간 파이프라인 (지연시간 < 16ms)

### 2.2 지원 기능 (Supporting Functions)
- **다중 센서 지원**: 최대 4개 센서 동시 입력 처리
- **HDR 처리**: 최대 4-frame HDR 합성
- **렌즈 보정**: 디스토션, 비네팅, 색수차 보정
- **얼굴/객체 검출**: AI 기반 실시간 검출 (NPU 연동)

### 2.3 입출력 인터페이스
| 인터페이스 | 방향 | 사양 | 프로토콜 | 용도 |
|------------|------|------|----------|------|
| MIPI CSI-2 | 입력 | 4-lane × 4채널, 2.5Gbps/lane | MIPI D-PHY 2.1 | 카메라 센서 데이터 |
| AXI4-Stream | 출력 | 128-bit, 400MHz | AXI4-Stream | 처리된 이미지 데이터 |
| AXI4-Lite | 양방향 | 32-bit, 200MHz | AXI4-Lite | 레지스터 제어 |
| 인터럽트 | 출력 | 32개 라인 | GPIO | 프레임 완료, 에러 신호 |

---

## 3. 성능 명세 (Performance Specifications)

### 3.1 처리 성능
| 항목 | 사양 | 단위 | 조건 | 비고 |
|------|------|------|------|------|
| 최대 해상도 | 200 | MP | 단일 센서 | 16,384×12,288 |
| 최대 프레임레이트 | 30 | fps | 200MP 기준 | |
| 듀얼 센서 성능 | 64MP@60fps | fps | 2센서 동시 | |
| 파이프라인 지연 | 16 | ms | End-to-End | |
| 처리 대역폭 | 25.6 | GB/s | 최대 로드 시 | |

### 3.2 화질 성능
| 항목 | 목표값 | 측정 방법 | 기준 |
|------|--------|-----------|------|
| SNR 개선 | 3 dB | ISO 12233 | 노이즈 리덕션 적용 시 |
| 색재현성 | ΔE < 3 | CIE LAB | D65 광원 기준 |
| 해상도 | 0.3 | LW/PH | MTF50 기준 |
| 다이나믹 레인지 | 14 | stops | HDR 모드 |

### 3.3 전력 성능
| 동작 모드 | 전력 소모 | 클록 주파수 | 처리 능력 |
|-----------|-----------|-------------|-----------|
| 최대 성능 | 1.8W | 800MHz | 200MP@30fps |
| 일반 모드 | 450mW | 400MHz | 64MP@30fps |
| 절전 모드 | 120mW | 200MHz | 12MP@30fps |
| 대기 모드 | 15mW | 50MHz | 설정 유지만 |

---

## 4. 아키텍처 설계 (Architecture Design)

### 4.1 전체 아키텍처
```
[MIPI CSI-2] → [입력 DMA] → [전처리] → [ISP Core] → [후처리] → [출력 DMA] → [AXI4-Stream]
                     ↓           ↓         ↓         ↓           ↓
               [메타데이터]  [통계정보] [AI검출] [화질보정] [포맷변환]
                     ↓           ↓         ↓         ↓           ↓
                           [제어 프로세서 (ARM Cortex-M7)]
```

### 4.2 주요 블록 구성
| 블록명 | 기능 | 하드웨어 리소스 | 면적 할당 |
|--------|------|-----------------|-----------|
| MIPI 수신기 | CSI-2 데이터 수신 | 4×4-lane D-PHY | 1.2 mm² |
| 입력 DMA | 센서 데이터 버퍼링 | 4×512KB SRAM | 2.8 mm² |
| ISP Core | 메인 이미지 처리 | 32×DSP 유닛 | 6.5 mm² |
| AI 검출기 | 얼굴/객체 검출 | 전용 NPU 슬라이스 | 2.1 mm² |
| 후처리 | 포맷 변환, 스케일링 | 8×변환 유닛 | 1.9 mm² |
| 제어 프로세서 | 알고리즘 제어 | ARM Cortex-M7 | 0.5 mm² |

### 4.3 메모리 구조
- **L1 캐시**: 64KB (명령어 32KB + 데이터 32KB)
- **L2 공유 메모리**: 2MB SRAM (라인 버퍼용)
- **통계 메모리**: 256KB (히스토그램, 통계 데이터)
- **외부 메모리**: 시스템 DDR5 (대용량 프레임 버퍼)

---

## 5. 클록 및 전력 설계 (Clock & Power Design)

### 5.1 클록 도메인
| 클록 도메인 | 주파수 | 용도 | 소스 |
|-------------|--------|------|------|
| isp_core_clk | 800 MHz | 메인 ISP 파이프라인 | PLL1 |
| axi_clk | 400 MHz | AXI 버스 인터페이스 | PLL1/2 |
| mipi_clk | 500 MHz | MIPI 수신기 | PLL2 |
| ctrl_clk | 200 MHz | 제어 프로세서 | PLL3 |
| ref_clk | 24 MHz | 기준 클록 | 외부 크리스탈 |

### 5.2 전력 도메인
- **Always-On**: 제어 레지스터, 클록 관리 (1.1V)
- **ISP Core**: 메인 처리 파이프라인 (0.8V, DVFS 지원)
- **MIPI PHY**: 고속 인터페이스 (1.8V/1.2V)
- **메모리**: SRAM 어레이 (0.9V, 리텐션 지원)

### 5.3 절전 기능
- **동적 클록 게이팅**: 블록별 자동 클록 차단 (98% 효율)
- **전력 게이팅**: 미사용 DSP 유닛 전원 차단
- **DVFS**: 성능 요구에 따른 동적 주파수 조정 (5단계)
- **센서별 독립 제어**: 사용하지 않는 센서 채널 완전 차단

---

## 6. 물리적 설계 (Physical Design)

### 6.1 면적 할당
- **총 할당 면적**: 14 mm² (Nova-8000 총 면적의 10%)
- **타겟 면적**: 13.2 mm² (5% 여유 공간)
- **형태**: 직사각형 4.6 × 2.9 mm

### 6.2 플로어플랜
```
┌─────────────┬─────────────┬─────────────┐
│ MIPI RX #1  │ MIPI RX #2  │ MIPI RX #3  │
├─────────────┼─────────────┼─────────────┤
│    INPUT DMA CONTROLLERS   │ CTRL CPU    │
├─────────────────────────────┼─────────────┤
│                             │             │
│      ISP CORE               │  AI DETECT  │
│   (DSP ARRAY 8×4)          │             │
│                             │             │
├─────────────────────────────┼─────────────┤
│    SHARED MEMORY (2MB)      │ POST PROC   │
├─────────────────────────────┴─────────────┤
│         AXI INTERFACE & DMA               │
└───────────────────────────────────────────┘
```

### 6.3 배치 고려사항
- **고속 신호 격리**: MIPI 수신기와 디지털 블록 분리
- **전력 섬**: 각 전력 도메인별 물리적 격리
- **열 분산**: DSP 어레이 균등 배치
- **클록 분배**: 중앙 집중식 클록 트리

---

## 7. 인터페이스 상세 설계 (Interface Design)

### 7.1 MIPI CSI-2 인터페이스
- **물리 계층**: MIPI D-PHY v2.1 호환
- **데이터 레이트**: 2.5 Gbps/lane (최대)
- **가상 채널**: 4개 VC 지원 (다중 센서)
- **데이터 타입**: RAW8/10/12/14/16, YUV422/420

### 7.2 AXI4 인터페이스
```verilog
// AXI4-Stream 출력 인터페이스
interface axi4s_if;
  logic [127:0] tdata;     // 128-bit 데이터
  logic [15:0]  tkeep;     // 바이트 유효 신호
  logic         tvalid;    // 데이터 유효
  logic         tready;    // 수신 준비
  logic         tlast;     // 프레임 끝
  logic [7:0]   tuser;     // 메타데이터
endinterface
```

### 7.3 제어 레지스터 맵
| 주소 범위 | 기능 | 접근 권한 |
|-----------|------|-----------|
| 0x0000-0x00FF | 시스템 제어 | R/W |
| 0x0100-0x01FF | MIPI 설정 | R/W |
| 0x0200-0x02FF | ISP 파라미터 | R/W |
| 0x0300-0x03FF | 통계 정보 | R |
| 0x0400-0x04FF | 인터럽트 제어 | R/W |

---

## 8. 검증 계획 (Verification Plan)

### 8.1 검증 환경
- **시뮬레이터**: Synopsys VCS 2024.03
- **테스트벤치**: SystemVerilog + UVM 1.2
- **참조 모델**: C++ 기반 비트 정확 모델
- **커버리지 툴**: Synopsys Verdi Coverage

### 8.2 테스트 시나리오
| 테스트 카테고리 | 테스트 케이스 수 | 우선순위 | 소요 시간 |
|-----------------|------------------|----------|-----------|
| 기본 기능 | 150 | 높음 | 2주 |
| 성능 검증 | 80 | 높음 | 1주 |
| 에러 처리 | 120 | 중간 | 1.5주 |
| 전력 관리 | 60 | 중간 | 1주 |
| 인터페이스 호환성 | 90 | 낮음 | 1주 |

### 8.3 커버리지 목표
- **코드 커버리지**: 95% (라인, 분기, 조건)
- **기능 커버리지**: 98% (명세서 기준)
- **어서션 커버리지**: 90% (SVA 기반)
- **크로스 커버리지**: 85% (모드별 조합)

### 8.4 검증 일정
```
Week 1-2: 테스트벤치 구축
Week 3-4: 기본 기능 검증
Week 5-6: 성능 및 스트레스 테스트
Week 7: 에러 시나리오 검증
Week 8: 시스템 통합 테스트
```

---

## 9. 구현 계획 (Implementation Plan)

### 9.1 설계 단계
| 단계 | 기간 | 주요 작업 | 산출물 |
|------|------|----------|--------|
| 아키텍처 | 3주 | 상세 아키텍처 설계 | 아키텍처 문서 |
| RTL 설계 | 8주 | Verilog 코딩 | RTL 소스 |
| 검증 | 8주 | 테스트벤치 및 검증 | 검증 리포트 |
| 합성 | 2주 | 논리 합성 및 최적화 | 넷리스트 |
| 물리설계 | 4주 | 배치 및 배선 | GDS |

### 9.2 개발 리소스
- **RTL 설계자**: 3명 (시니어 1명, 주니어 2명)
- **검증 엔지니어**: 2명 (리드 1명, 엔지니어 1명)
- **물리설계자**: 1명 (전담)
- **시스템 통합**: 1명 (파트타임)

### 9.3 핵심 마일스톤
- **M1**: 아키텍처 리뷰 완료 (Week 3)
- **M2**: RTL 초기 버전 완료 (Week 7)
- **M3**: 기본 기능 검증 완료 (Week 13)
- **M4**: 합성 및 타이밍 클로저 (Week 17)
- **M5**: 물리설계 완료 (Week 21)

---

## 10. 품질 및 신뢰성 (Quality & Reliability)

### 10.1 품질 메트릭
- **기능 정확성**: 참조 모델 대비 100% 일치
- **성능 목표**: 명세 대비 ±5% 이내
- **전력 효율**: 목표 대비 10% 개선
- **면적 효율**: 할당 면적 내 구현

### 10.2 신뢰성 설계
- **ECC 보호**: 모든 SRAM에 SECDED ECC 적용
- **에러 검출**: CRC 체크섬 및 패리티 검사
- **복구 메커니즘**: 소프트 에러 자동 복구
- **온도 모니터링**: 과열 보호 및 성능 조절

### 10.3 테스트 가능성
- **DFT 삽입**: 98% 스캔 커버리지
- **BIST**: 메모리 자체 테스트
- **관측점**: 내부 신호 디버깅 지원
- **제어점**: 테스트 모드 진입

---

## 11. 위험 요소 및 대응 (Risk Management)

### 11.1 기술적 위험
| 위험 요소 | 확률 | 영향 | 완화 방안 |
|-----------|------|------|----------|
| 타이밍 클로저 실패 | 중간 | 높음 | 조기 합성, 플로어플랜 최적화 |
| 전력 목표 초과 | 낮음 | 중간 | 전력 분석, 아키텍처 조정 |
| IP 인터페이스 불일치 | 낮음 | 높음 | 조기 통합 테스트 |

### 11.2 일정 위험
| 위험 요소 | 확률 | 영향 | 완화 방안 |
|-----------|------|------|----------|
| 검증 복잡성 증가 | 높음 | 중간 | 병렬 검증, 자동화 강화 |
| 리소스 부족 | 중간 | 높음 | 백업 인력, 외주 활용 |

### 11.3 비용 위험
- **개발 비용**: 예산 대비 15% 여유 확보
- **IP 라이선스**: 다중 벤더 옵션 검토
- **툴 비용**: 클라우드 기반 라이선스 활용

---

## 12. 승인 및 검토 (Approval & Review)

### 12.1 검토 이력
| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| v0.1 | 2025-09-10 | 초안 작성 | 정수연 |
| v0.5 | 2025-09-12 | 아키텍처 구체화 | 정수연 |
| v1.0 | 2025-09-14 | 최종 검토 완료 | 정수연 |

### 12.2 승인
- **모듈 설계 검토**: 정수연 (ISP Team Lead) _________________ (2025-09-13)
- **시스템 통합 검토**: 김철수 (SoC Team Lead) _________________ (2025-09-13)
- **최종 승인**: 박영희 (Design Manager) _________________ (2025-09-14)

---

**문서 분류**: 대외비 (Company Confidential)  
**상위 문서**: Nova-8000 AP 설계 명세서 v1.0  
**관련 문서**: MIPI CSI-2 인터페이스 명세서, AXI4 버스 명세서  
**보관 기간**: 7년  
**다음 검토일**: 2025-11-14

